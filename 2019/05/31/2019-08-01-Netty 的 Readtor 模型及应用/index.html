<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="Reactor æ¨¡å‹åŠå…¶åœ¨ Netty ä¸­çš„åº”ç”¨"/><meta name="keywords" content="æŠ€æœ¯ Java Rust" /><link rel="alternate" href="/default" title="Ubik's blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="http://yoursite.com/2019/05/31/2019-08-01-Netty çš„ Readtor æ¨¡å‹åŠåº”ç”¨/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" /><script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":true};
</script>

    <title>Reactor æ¨¡å‹åŠå…¶åœ¨ Netty ä¸­çš„åº”ç”¨ - Ubik's blog</title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Ubik's blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Ubik's blog</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">Reactor æ¨¡å‹åŠå…¶åœ¨ Netty ä¸­çš„åº”ç”¨
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-05-31
        </span></div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Reactor-çš„ä¸‰ç§å®ç°"><span class="toc-text">Reactor çš„ä¸‰ç§å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#å•-Reactor-å•çº¿ç¨‹æ¨¡å‹"><span class="toc-text">å• Reactor å•çº¿ç¨‹æ¨¡å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å•-Reactor-å¤šçº¿ç¨‹æ¨¡å‹"><span class="toc-text">å• Reactor å¤šçº¿ç¨‹æ¨¡å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¤š-Reactor-å¤šçº¿ç¨‹æ¨¡å‹"><span class="toc-text">å¤š Reactor å¤šçº¿ç¨‹æ¨¡å‹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Netty-ä¸­çš„åº”ç”¨"><span class="toc-text">Netty ä¸­çš„åº”ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NIO-å®¢æˆ·ç«¯"><span class="toc-text">NIO å®¢æˆ·ç«¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NIO-æœåŠ¡ç«¯"><span class="toc-text">NIO æœåŠ¡ç«¯</span></a></li></ol></li></ol>
    </div>
  </div><div class="post-content"><p>EventLoop æ˜¯ Netty åŸºäº Reactor æ¨¡å‹çš„æ€æƒ³è¿›è¡Œå®ç°ï¼Œåœ¨è¯» EventLoop çš„æºç ä¹‹å‰ï¼Œæœ‰å¿…è¦äº†è§£è¿™ä¸ªä¸œè¥¿ã€‚<br>wiki: </p>
<blockquote>
<p>The reactor design pattern is an event handling pattern for handling service requests delivered concurrently to a service handler by one or more inputs. The service handler then demultiplexes the incoming requests and dispatches them synchronously to the associated request handlers.</p>
</blockquote>
<p>ä¹Ÿä¸å¤æ‚ï¼Œå…¶æ ¸å¿ƒæ€æƒ³å°±æ˜¯<strong>å°†å…³æ³¨çš„ I/O äº‹ä»¶æ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œä¸€æ—¦æœ‰ I/O äº‹ä»¶è§¦å‘ï¼Œå°†äº‹ä»¶åˆ†å‘åˆ°äº‹ä»¶å¤„ç†å™¨ä¸­ï¼Œæ‰§è¡Œå°±ç»ª I/O äº‹ä»¶å¯¹åº”çš„å¤„ç†å‡½æ•°ä¸­ã€‚</strong>æ¨¡å‹ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„ç»„ä»¶ï¼š</p>
<ol>
<li><p>å¤šè·¯å¤ç”¨å™¨ï¼šç”±æ“ä½œç³»ç»Ÿæä¾›æ¥å£ï¼ŒLinux æä¾›çš„ I/O å¤ç”¨æ¥å£æœ‰selectã€pollã€epoll ã€‚</p>
</li>
<li><p>äº‹ä»¶åˆ†ç¦»å™¨ï¼šå°†å¤šè·¯å¤ç”¨å™¨è¿”å›çš„å°±ç»ªäº‹ä»¶åˆ†å‘åˆ°äº‹ä»¶å¤„ç†å™¨ä¸­ã€‚</p>
</li>
<li><p>äº‹ä»¶å¤„ç†å™¨ï¼šå¤„ç†å°±ç»ªäº‹ä»¶å¤„ç†å‡½æ•°ã€‚</p>
</li>
</ol>
<h1 id="Reactor-çš„ä¸‰ç§å®ç°"><a href="#Reactor-çš„ä¸‰ç§å®ç°" class="headerlink" title="Reactor çš„ä¸‰ç§å®ç°"></a>Reactor çš„ä¸‰ç§å®ç°</h1><ol>
<li><p>å• Reactor å•çº¿ç¨‹æ¨¡å‹</p>
</li>
<li><p>å• Reactor å¤šçº¿ç¨‹æ¨¡å‹</p>
</li>
<li><p>å¤š Reactor å¤šçº¿ç¨‹æ¨¡å‹</p>
</li>
</ol>
<p>ä¸‹è¾¹æˆ‘ä»¬æ¥åˆ†æ</p>
<h2 id="å•-Reactor-å•çº¿ç¨‹æ¨¡å‹"><a href="#å•-Reactor-å•çº¿ç¨‹æ¨¡å‹" class="headerlink" title="å• Reactor å•çº¿ç¨‹æ¨¡å‹"></a>å• Reactor å•çº¿ç¨‹æ¨¡å‹</h2><p><img src="/img/235321555549FA0C8EC19CC77D47169A.jpg" alt=""><br>ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ç­‰å¾…äº‹ä»¶åˆ°æ¥ï¼Œåˆ†å‘äº‹ä»¶å¤„ç†</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reactor</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Reactor</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      SelectionKey sk = serverSocket.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">      <span class="comment">// attach Acceptor å¤„ç†æ–°è¿æ¥</span></span><br><span class="line">      sk.attach(<span class="keyword">new</span> Acceptor());</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">â€‹  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">while</span> (!Thread.interrupted()) &#123;</span><br><span class="line">              selector.select();</span><br><span class="line">              Set selected = selector.selectedKeys();</span><br><span class="line">              Iterator it = selected.iterator();</span><br><span class="line">              <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                  it.remove();</span><br><span class="line">                  <span class="comment">//åˆ†å‘äº‹ä»¶å¤„ç†</span></span><br><span class="line">                  dispatch((SelectionKey) (it.next()));</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">          <span class="comment">//do something</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dispatch</span><span class="params">(SelectionKey k)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// è‹¥æ˜¯è¿æ¥äº‹ä»¶è·å–æ˜¯acceptor</span></span><br><span class="line">      <span class="comment">// è‹¥æ˜¯IOè¯»å†™äº‹ä»¶è·å–æ˜¯handler</span></span><br><span class="line">      Runnable runnable = (Runnable) (k.attachment());</span><br><span class="line">      <span class="keyword">if</span> (runnable != <span class="keyword">null</span>) &#123;</span><br><span class="line">          runnable.run();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯æœ€åŸºç¡€çš„å• Reactor å•çº¿ç¨‹æ¨¡å‹ã€‚</p>
<p>Reactor çº¿ç¨‹ï¼Œè´Ÿè´£å¤šè·¯åˆ†ç¦»å¥—æ¥å­—ã€‚</p>
<p>æœ‰æ–°è¿æ¥åˆ°æ¥è§¦å‘ OP_ACCEPT äº‹ä»¶ä¹‹åï¼Œ äº¤ç”± Acceptor è¿›è¡Œå¤„ç†ã€‚<br>æœ‰ IO è¯»å†™äº‹ä»¶ä¹‹åï¼Œäº¤ç»™ Handler å¤„ç†ã€‚<br>Acceptor ä¸»è¦ä»»åŠ¡æ˜¯æ„é€  Handler ã€‚</p>
<p>åœ¨è·å–åˆ° Client ç›¸å…³çš„ SocketChannel ä¹‹åï¼Œç»‘å®šåˆ°ç›¸åº”çš„ Handler ä¸Šã€‚å¯¹åº”çš„ SocketChannel æœ‰è¯»å†™äº‹ä»¶ä¹‹åï¼ŒåŸºäº Reactor åˆ†å‘ï¼ŒHandler å°±å¯ä»¥å¤„ç†äº†ã€‚</p>
<p>æ³¨æ„ï¼Œæ‰€æœ‰çš„ IO äº‹ä»¶éƒ½ç»‘å®šåˆ° Selector ä¸Šï¼Œç”± Reactor ç»Ÿä¸€åˆ†å‘ã€‚<br>è¯¥æ¨¡å‹é€‚ç”¨äºå¤„ç†å™¨é“¾ä¸­ä¸šåŠ¡å¤„ç†ç»„ä»¶èƒ½å¿«é€Ÿå®Œæˆçš„åœºæ™¯ã€‚ä¸è¿‡ï¼Œè¿™ç§å•çº¿ç¨‹æ¨¡å‹ä¸èƒ½å……åˆ†åˆ©ç”¨å¤šæ ¸èµ„æºï¼Œæ‰€ä»¥å®é™…ä½¿ç”¨çš„ä¸å¤šã€‚</p>
<h2 id="å•-Reactor-å¤šçº¿ç¨‹æ¨¡å‹"><a href="#å•-Reactor-å¤šçº¿ç¨‹æ¨¡å‹" class="headerlink" title="å• Reactor å¤šçº¿ç¨‹æ¨¡å‹"></a>å• Reactor å¤šçº¿ç¨‹æ¨¡å‹</h2><p><img src="/img/D0784A26CAE5C4015A0D51697C9753C5.jpg" alt="æ’å›¾"><br>ç›¸å¯¹äºç¬¬ä¸€ç§å•çº¿ç¨‹çš„æ¨¡å¼æ¥è¯´ï¼Œåœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯è·å–åˆ° IO çš„è¯»å†™äº‹ä»¶ä¹‹åï¼Œäº¤ç”±çº¿ç¨‹æ± æ¥å¤„ç†ï¼Œè¿™æ ·å¯ä»¥å‡å°ä¸» Reactor çš„æ€§èƒ½å¼€é”€ï¼Œä»è€Œæ›´ä¸“æ³¨çš„åšäº‹ä»¶åˆ†å‘å·¥ä½œäº†ï¼Œä»è€Œæå‡æ•´ä¸ªåº”ç”¨çš„ååã€‚</p>
<p>MultiThreadHandler ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¤šçº¿ç¨‹å¤„ç†è¯»å†™ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiThreadHandler</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> READING = <span class="number">0</span>, WRITING = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> state;</span><br><span class="line">  <span class="keyword">final</span> SocketChannel socket;</span><br><span class="line">  <span class="keyword">final</span> SelectionKey sk;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="comment">//å¤šçº¿ç¨‹å¤„ç†ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">  ExecutorService executorService = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());</span><br><span class="line">â€‹</span><br><span class="line">â€‹</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MultiThreadHandler</span><span class="params">(SocketChannel socket, Selector sl)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.state = READING;</span><br><span class="line">      <span class="keyword">this</span>.socket = socket;</span><br><span class="line">      sk = socket.register(selector, SelectionKey.OP_READ);</span><br><span class="line">      sk.attach(<span class="keyword">this</span>);</span><br><span class="line">      socket.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (state == READING) &#123;</span><br><span class="line">          read();</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == WRITING) &#123;</span><br><span class="line">          write();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//ä»»åŠ¡å¼‚æ­¥å¤„ç†</span></span><br><span class="line">      executorService.submit(() -&gt; process());</span><br><span class="line">â€‹</span><br><span class="line">      <span class="comment">//ä¸‹ä¸€æ­¥å¤„ç†å†™äº‹ä»¶</span></span><br><span class="line">      sk.interestOps(SelectionKey.OP_WRITE);</span><br><span class="line">      <span class="keyword">this</span>.state = WRITING;</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//ä»»åŠ¡å¼‚æ­¥å¤„ç†</span></span><br><span class="line">      executorService.submit(() -&gt; process());</span><br><span class="line">â€‹</span><br><span class="line">      <span class="comment">//ä¸‹ä¸€æ­¥å¤„ç†è¯»äº‹ä»¶</span></span><br><span class="line">      sk.interestOps(SelectionKey.OP_READ);</span><br><span class="line">      <span class="keyword">this</span>.state = READING;</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * task ä¸šåŠ¡å¤„ç†</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//do IO ,task,queue something</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ #read() å’Œ #write() æ–¹æ³•ä¸­ï¼Œæäº¤ executorService çº¿ç¨‹æ± ï¼Œè¿›è¡Œå¤„ç†ã€‚</p>
<h2 id="å¤š-Reactor-å¤šçº¿ç¨‹æ¨¡å‹"><a href="#å¤š-Reactor-å¤šçº¿ç¨‹æ¨¡å‹" class="headerlink" title="å¤š Reactor å¤šçº¿ç¨‹æ¨¡å‹"></a>å¤š Reactor å¤šçº¿ç¨‹æ¨¡å‹</h2><p><img src="/img/8D476F61A64657CFD90DAC82C7D23D17.jpg" alt="æ’å›¾"><br>ç¬¬ä¸‰ç§æ¨¡å‹æ¯”èµ·ç¬¬äºŒç§æ¨¡å‹ï¼Œæ˜¯å°† Reactor åˆ†æˆä¸¤éƒ¨åˆ†ï¼š</p>
<ol>
<li><p>mainReactor è´Ÿè´£ç›‘å¬ ServerSocketChannel ï¼Œç”¨æ¥å¤„ç†å®¢æˆ·ç«¯æ–°è¿æ¥çš„å»ºç«‹ï¼Œå¹¶å°†å»ºç«‹çš„å®¢æˆ·ç«¯çš„ SocketChannel æŒ‡å®šæ³¨å†Œç»™ subReactor ã€‚</p>
</li>
<li><p>subReactor ç»´æŠ¤è‡ªå·±çš„ Selector ï¼ŒåŸºäº mainReactor å»ºç«‹çš„å®¢æˆ·ç«¯çš„ SocketChannel å¤šè·¯åˆ†ç¦» IO è¯»å†™äº‹ä»¶ï¼Œè¯»å†™ç½‘ç»œæ•°æ®ã€‚å¯¹äºä¸šåŠ¡å¤„ç†çš„åŠŸèƒ½ï¼Œå¦å¤–æ‰”ç»™ worker çº¿ç¨‹æ± æ¥å®Œæˆã€‚<br>MultiWorkThreadAcceptor ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¤šwork è¿æ¥äº‹ä»¶Acceptor,å¤„ç†è¿æ¥äº‹ä»¶</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiWorkThreadAcceptor</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="comment">// cpuçº¿ç¨‹æ•°ç›¸åŒå¤šworkçº¿ç¨‹</span></span><br><span class="line">  <span class="keyword">int</span> workCount = Runtime.getRuntime().availableProcessors();</span><br><span class="line">  SubReactor[] workThreadHandlers = <span class="keyword">new</span> SubReactor[workCount];</span><br><span class="line">  <span class="keyword">volatile</span> <span class="keyword">int</span> nextHandler = <span class="number">0</span>;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MultiWorkThreadAcceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.init();</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      nextHandler = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; workThreadHandlers.length; i++) &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              workThreadHandlers[i] = <span class="keyword">new</span> SubReactor();</span><br><span class="line">          &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          SocketChannel c = serverSocket.accept();</span><br><span class="line">          <span class="keyword">if</span> (c != <span class="keyword">null</span>) &#123;<span class="comment">// æ³¨å†Œè¯»å†™</span></span><br><span class="line">              <span class="keyword">synchronized</span> (c) &#123;</span><br><span class="line">                  <span class="comment">// é¡ºåºè·å–SubReactorï¼Œç„¶åæ³¨å†Œchannel </span></span><br><span class="line">                  SubReactor work = workThreadHandlers[nextHandler];</span><br><span class="line">                  work.registerChannel(c);</span><br><span class="line">                  nextHandler++;</span><br><span class="line">                  <span class="keyword">if</span> (nextHandler &gt;= workThreadHandlers.length) &#123;</span><br><span class="line">                      nextHandler = <span class="number">0</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>SubReactor ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¤šworkçº¿ç¨‹å¤„ç†è¯»å†™ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubReactor</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Selector mySelector;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="comment">//å¤šçº¿ç¨‹å¤„ç†ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">  <span class="keyword">int</span> workCount =Runtime.getRuntime().availableProcessors();</span><br><span class="line">  ExecutorService executorService = Executors.newFixedThreadPool(workCount);</span><br><span class="line">â€‹</span><br><span class="line">â€‹</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SubReactor</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// æ¯ä¸ªSubReactor ä¸€ä¸ªselector </span></span><br><span class="line">      <span class="keyword">this</span>.mySelector = SelectorProvider.provider().openSelector();</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ³¨å†Œchanel</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> sc</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerChannel</span><span class="params">(SocketChannel sc)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      sc.register(mySelector, SelectionKey.OP_READ | SelectionKey.OP_CONNECT);</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//æ¯ä¸ªSubReactor è‡ªå·±åšäº‹ä»¶åˆ†æ´¾å¤„ç†è¯»å†™äº‹ä»¶</span></span><br><span class="line">              selector.select();</span><br><span class="line">              Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class="line">              Iterator&lt;SelectionKey&gt; iterator = keys.iterator();</span><br><span class="line">              <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                  SelectionKey key = iterator.next();</span><br><span class="line">                  iterator.remove();</span><br><span class="line">                  <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                      read();</span><br><span class="line">                  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable()) &#123;</span><br><span class="line">                      write();</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">â€‹</span><br><span class="line">          &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">â€‹</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//ä»»åŠ¡å¼‚æ­¥å¤„ç†</span></span><br><span class="line">      executorService.submit(() -&gt; process());</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//ä»»åŠ¡å¼‚æ­¥å¤„ç†</span></span><br><span class="line">      executorService.submit(() -&gt; process());</span><br><span class="line">  &#125;</span><br><span class="line">â€‹</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * task ä¸šåŠ¡å¤„ç†</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//do IO ,task,queue something</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<p>mainReactor ä¸»è¦ç”¨æ¥å¤„ç†ç½‘ç»œ IO è¿æ¥å»ºç«‹æ“ä½œï¼Œé€šå¸¸ï¼ŒmainReactor åªéœ€è¦ä¸€ä¸ªï¼Œå› ä¸ºå®ƒä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†ã€‚<br>subReactor ä¸»è¦å’Œå»ºç«‹èµ·æ¥çš„å®¢æˆ·ç«¯çš„ SocketChannel åšæ•°æ®äº¤äº’å’Œäº‹ä»¶ä¸šåŠ¡å¤„ç†æ“ä½œã€‚é€šå¸¸ï¼ŒsubReactor çš„ä¸ªæ•°å’Œ CPU ä¸ªæ•°ç›¸ç­‰ï¼Œæ¯ä¸ª subReactor ç‹¬å ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚<br>æ­¤ç§æ¨¡å¼ä¸­ï¼Œæ¯ä¸ªæ¨¡å—çš„å·¥ä½œæ›´åŠ ä¸“ä¸€ï¼Œè€¦åˆåº¦æ›´ä½ï¼Œæ€§èƒ½å’Œç¨³å®šæ€§ä¹Ÿå¤§å¤§çš„æå‡ï¼Œæ”¯æŒçš„å¯å¹¶å‘å®¢æˆ·ç«¯æ•°é‡å¯è¾¾åˆ°ä¸Šç™¾ä¸‡çº§åˆ«ã€‚<br>å…³äºæ­¤ç§æ¨¡å¼çš„åº”ç”¨ï¼Œç›®å‰æœ‰å¾ˆå¤šä¼˜ç§€çš„æ¡†æ¶å·²ç»åœ¨åº”ç”¨ï¼Œæ¯”å¦‚ Mina å’Œ Netty ç­‰ç­‰ã€‚ä¸Šè¿°ä¸­å»æ‰çº¿ç¨‹æ± çš„ç¬¬ä¸‰ç§å½¢å¼çš„å˜ç§ï¼Œä¹Ÿæ˜¯ Netty NIO çš„é»˜è®¤æ¨¡å¼ã€‚</p>
<h1 id="Netty-ä¸­çš„åº”ç”¨"><a href="#Netty-ä¸­çš„åº”ç”¨" class="headerlink" title="Netty ä¸­çš„åº”ç”¨"></a>Netty ä¸­çš„åº”ç”¨</h1><h2 id="NIO-å®¢æˆ·ç«¯"><a href="#NIO-å®¢æˆ·ç«¯" class="headerlink" title="NIO å®¢æˆ·ç«¯"></a>NIO å®¢æˆ·ç«¯</h2><p>Netty NIO å®¢æˆ·ç«¯çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œå’Œ EventLoop ç›¸å…³çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª EventLoopGroup å¯¹è±¡</span></span><br><span class="line">EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"><span class="comment">// åˆ›å»º Bootstrap å¯¹è±¡</span></span><br><span class="line">Bootstrap b = <span class="keyword">new</span> Bootstrap();</span><br><span class="line"><span class="comment">// è®¾ç½®ä½¿ç”¨çš„ EventLoopGroup</span></span><br><span class="line">b.group(group);</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯¹äº Netty NIO å®¢æˆ·ç«¯æ¥è¯´ï¼Œä»…åˆ›å»ºä¸€ä¸ª EventLoopGroup ã€‚</li>
</ul>
<ul>
<li>ä¸€ä¸ª EventLoop å¯ä»¥å¯¹åº”ä¸€ä¸ª Reactor ã€‚å› ä¸º EventLoopGroup æ˜¯ EventLoop çš„åˆ†ç»„ï¼Œæ‰€ä»¥å¯¹ç­‰ç†è§£ï¼ŒEventLoopGroup æ˜¯ä¸€ç§ Reactor çš„åˆ†ç»„ã€‚</li>
<li>ä¸€ä¸ª Bootstrap çš„å¯åŠ¨ï¼Œåªèƒ½å‘èµ·å¯¹ä¸€ä¸ªè¿œç¨‹çš„åœ°å€ã€‚æ‰€ä»¥åªä¼šä½¿ç”¨ä¸€ä¸ª NIO Selector ï¼Œä¹Ÿå°±æ˜¯è¯´ä»…ä½¿ç”¨ä¸€ä¸ª Reactor ã€‚å³ä½¿ï¼Œæˆ‘ä»¬åœ¨å£°æ˜ä½¿ç”¨ä¸€ä¸ª EventLoopGroup ï¼Œè¯¥ EventLoopGroup ä¹Ÿåªä¼šåˆ†é…ä¸€ä¸ª EventLoop å¯¹ IO äº‹ä»¶è¿›è¡Œå¤„ç†ã€‚</li>
<li>å› ä¸º Reactor æ¨¡å‹ä¸»è¦ä½¿ç”¨æœåŠ¡ç«¯çš„å¼€å‘ä¸­ï¼Œå¦‚æœå¥—ç”¨åœ¨ Netty NIO å®¢æˆ·ç«¯ä¸­ï¼Œåˆ°åº•ä½¿ç”¨äº†å“ªä¸€ç§æ¨¡å¼å‘¢ï¼Ÿ</li>
<li>å¦‚æœåªæœ‰ä¸€ä¸ªä¸šåŠ¡çº¿ç¨‹ä½¿ç”¨ Netty NIO å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºæ˜¯ã€å• Reactor å•çº¿ç¨‹æ¨¡å‹ã€‘ã€‚<ul>
<li>å¦‚æœæœ‰å¤šä¸ªä¸šåŠ¡çº¿ç¨‹ä½¿ç”¨ Netty NIO å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºæ˜¯ã€å• Reactor å¤šçº¿ç¨‹æ¨¡å‹ã€‘ã€‚<br>é‚£ä¹ˆ Netty NIO å®¢æˆ·ç«¯æ˜¯å¦èƒ½å¤Ÿä½¿ç”¨ã€å¤š Reactor å¤šçº¿ç¨‹æ¨¡å‹ã€‘å‘¢ï¼ŸğŸ˜ˆ åˆ›å»ºå¤šä¸ª Netty NIO å®¢æˆ·ç«¯ï¼Œè¿æ¥åŒä¸€ä¸ªæœåŠ¡ç«¯ã€‚é‚£ä¹ˆå¤šä¸ª Netty å®¢æˆ·ç«¯å°±å¯ä»¥è®¤ä¸ºç¬¦åˆå¤š Reactor å¤šçº¿ç¨‹æ¨¡å‹äº†ã€‚<br>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä¼šè¿™ä¹ˆå¹²ã€‚</li>
</ul>
</li>
</ul>
<p>å½“ç„¶ï¼Œå®é™…ä¹Ÿæœ‰è¿™æ ·çš„ç¤ºä¾‹ã€‚ä¾‹å¦‚ Dubbo æˆ– Motan è¿™ä¸¤ä¸ª RPC æ¡†æ¶ï¼Œæ”¯æŒé€šè¿‡é…ç½®ï¼ŒåŒä¸€ä¸ª Consumer å¯¹åŒä¸€ä¸ª Provider å®ä¾‹åŒæ—¶å»ºç«‹å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚</p>
<h2 id="NIO-æœåŠ¡ç«¯"><a href="#NIO-æœåŠ¡ç«¯" class="headerlink" title="NIO æœåŠ¡ç«¯"></a>NIO æœåŠ¡ç«¯</h2><p> Netty NIO æœåŠ¡ç«¯çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œå’Œ EventLoop ç›¸å…³çš„ä»£ç ï¼š<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// åˆ›å»ºä¸¤ä¸ª EventLoopGroup å¯¹è±¡</span></span><br><span class="line">EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>); <span class="comment">// åˆ›å»º boss çº¿ç¨‹ç»„ ç”¨äºæœåŠ¡ç«¯æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line">EventLoopGroup workerGroup = <span class="keyword">new</span> NioEventLoopGroup(); <span class="comment">// åˆ›å»º worker çº¿ç¨‹ç»„ ç”¨äºè¿›è¡Œ SocketChannel çš„æ•°æ®è¯»å†™</span></span><br><span class="line"><span class="comment">// åˆ›å»º ServerBootstrap å¯¹è±¡</span></span><br><span class="line">ServerBootstrap b = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line"><span class="comment">// è®¾ç½®ä½¿ç”¨çš„ EventLoopGroup</span></span><br><span class="line">b.group(bossGroup, workerGroup);</span><br></pre></td></tr></table></figure><br>å¯¹äº Netty NIO æœåŠ¡ç«¯æ¥è¯´ï¼Œåˆ›å»ºä¸¤ä¸ª EventLoopGroup ã€‚</p>
<ol>
<li>bossGroup å¯¹åº” Reactor æ¨¡å¼çš„ mainReactor ï¼Œç”¨äºæœåŠ¡ç«¯æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥ã€‚æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ï¼Œä¼ å…¥äº†æ–¹æ³•å‚æ•° nThreads = 1 ï¼Œè¡¨ç¤ºåªä½¿ç”¨ä¸€ä¸ª EventLoop ï¼Œå³åªä½¿ç”¨ä¸€ä¸ª Reactor ã€‚è¿™ä¸ªä¹Ÿç¬¦åˆæˆ‘ä»¬ä¸Šé¢æåˆ°çš„ï¼Œâ€œé€šå¸¸ï¼ŒmainReactor åªéœ€è¦ä¸€ä¸ªï¼Œå› ä¸ºå®ƒä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†â€ã€‚</li>
</ol>
<ol start="2">
<li>workerGroup å¯¹åº” Reactor æ¨¡å¼çš„ subReactor ï¼Œç”¨äºè¿›è¡Œ SocketChannel çš„æ•°æ®è¯»å†™ã€‚å¯¹äº EventLoopGroup ï¼Œå¦‚æœæœªä¼ é€’æ–¹æ³•å‚æ•° nThreads ï¼Œè¡¨ç¤ºä½¿ç”¨ CPU ä¸ªæ•° Reactor ã€‚è¿™ä¸ªä¹Ÿç¬¦åˆæˆ‘ä»¬ä¸Šé¢æåˆ°çš„ï¼Œâ€œé€šå¸¸ï¼ŒsubReactor çš„ä¸ªæ•°å’Œ CPU ä¸ªæ•°ç›¸ç­‰ï¼Œæ¯ä¸ª subReactor ç‹¬å ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†â€ã€‚</li>
</ol>
<p>å› ä¸ºä½¿ç”¨ä¸¤ä¸ª EventLoopGroup ï¼Œæ‰€ä»¥ç¬¦åˆã€å¤š Reactor å¤šçº¿ç¨‹æ¨¡å‹ã€‘çš„å¤š Reactor çš„è¦æ±‚ã€‚å®é™…åœ¨ä½¿ç”¨æ—¶ï¼ŒworkerGroup åœ¨è¯»å®Œæ•°æ®æ—¶ï¼Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæˆ‘ä»¬ä¼šæäº¤åˆ°ä¸“é—¨çš„ä¸šåŠ¡é€»è¾‘çº¿ç¨‹æ± ï¼Œä¾‹å¦‚åœ¨ Dubbo æˆ– Motan è¿™ä¸¤ä¸ª RPC æ¡†æ¶ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±å®Œå…¨ç¬¦åˆã€å¤š Reactor å¤šçº¿ç¨‹æ¨¡å‹ã€‘ã€‚<br>é‚£ä¹ˆå¯èƒ½æœ‰èƒ–å‹å¯èƒ½å’Œæˆ‘æœ‰ä¸€æ ·çš„ç–‘é—®ï¼ŒbossGroup å¦‚æœé…ç½®å¤šä¸ªçº¿ç¨‹ï¼Œæ˜¯å¦å¯ä»¥ä½¿ç”¨å¤šä¸ª mainReactor å‘¢ï¼Ÿæˆ‘ä»¬æ¥åˆ†æä¸€æ³¢ï¼Œä¸€ä¸ª Netty NIO æœåŠ¡ç«¯åŒä¸€æ—¶é—´ï¼Œåªèƒ½ bind ä¸€ä¸ªç«¯å£ï¼Œé‚£ä¹ˆåªèƒ½ä½¿ç”¨ä¸€ä¸ª Selector å¤„ç†å®¢æˆ·ç«¯è¿æ¥äº‹ä»¶ã€‚åˆå› ä¸ºï¼ŒSelector æ“ä½œæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥æ— æ³•åœ¨å¤šä¸ª EventLoop ( å¤šä¸ªçº¿ç¨‹ )ä¸­ï¼ŒåŒæ—¶æ“ä½œã€‚æ‰€ä»¥è¿™æ ·å°±å¯¼è‡´ï¼Œå³ä½¿ bossGroup é…ç½®å¤šä¸ªçº¿ç¨‹ï¼Œå®é™…èƒ½å¤Ÿä½¿ç”¨çš„ä¹Ÿå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚<br>é‚£ä¹ˆå¦‚æœä¸€å®šä¸€å®šä¸€å®šè¦å¤šä¸ª mainReactor å‘¢ï¼Ÿåˆ›å»ºå¤šä¸ª Netty NIO æœåŠ¡ç«¯ï¼Œå¹¶ç»‘å®šå¤šä¸ªç«¯å£ã€‚</p>
<p>å‚è€ƒèµ„æ–™</p>
<ol>
<li><a href="https://my.oschina.net/u/1859679/blog/1844109" target="_blank" rel="noopener">NIOç³»åˆ—â€”â€”ä¹‹Reactoræ¨¡å‹</a></li>
<li><a href="https://tech.youzan.com/yi-bu-wang-luo-mo-xing/" target="_blank" rel="noopener">å¼‚æ­¥ç½‘ç»œæ¨¡å‹</a> Psï¼šé«˜ç«¯å†…å®¹ï¼Œæ¨è</li>
<li><a href="https://en.wikipedia.org/wiki/Reactor_pattern" target="_blank" rel="noopener">Reactor_pattern-wiki</a></li>
</ol>

      </div>
      <div class="post-copyright">
    <p class="copyright-item">
      <span>Author: </span>
      <a href="http://yoursite.com">Adam Ubik</a>
    </p>
    <p class="copyright-item">
      <span>Link: </span>
      <a href="http://yoursite.com/2019/05/31/2019-08-01-Netty%20%E7%9A%84%20Readtor%20%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%BA%94%E7%94%A8/">http://yoursite.com/2019/05/31/2019-08-01-Netty%20%E7%9A%84%20Readtor%20%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%BA%94%E7%94%A8/</a>
    </p>
    <p class="copyright-item">
      <span>License: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>
    </p>
  </div>
      <footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/Netty/">Netty</a>
            <a href="/tags/Reactor/">Reactor</a>
            <a href="/tags/%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/">å¤šè·¯å¤ç”¨</a>
            </div>
        
        <nav class="post-nav"><a class="prev" href="/2019/06/02/2019-06-12-%E4%BD%BF%E7%94%A8%20Lambda%20%E8%A1%A8%E8%BE%BE%E5%BC%8F%E9%87%8D%E6%9E%84%20OO%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Lambda è¡¨è¾¾å¼é‡æ„ OO è®¾è®¡æ¨¡å¼</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    <a class="next" href="/2019/05/29/2019-05-23-JDK%E5%AE%9E%E7%8E%B0%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84RPC%E6%A1%86%E6%9E%B6/">
        <span class="next-text nav-default">Java å®ç°æœ€ç®€å•çš„RPCæ¡†æ¶</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:Dingbiao1998@icloud.com" target="_blank" rel="noopener" class="iconfont icon-email" title="email"></a>
        <a href="https://github.com/Ubique0305" target="_blank" rel="noopener" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even" target="_blank" rel="noopener">Even</a>
  </span>

  <span class="copyright-year">&copy;2018 - 2019<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Adam Ubik</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
